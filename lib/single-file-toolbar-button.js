!function(){"use strict";class t{constructor(){this.button=null,this.container=null,this.isVisible=!1,this.init()}init(){document.getElementById("singlefile-toolbar-container")||(this.createToolbar(),this.setupScrollListener(),this.setupPageChangeListener(),this.setupDownloadListener())}createToolbar(){this.container=document.createElement("div"),this.container.id="singlefile-toolbar-container",this.container.className="singlefile-toolbar-container",this.input=document.createElement("input"),this.input.id="singlefile-toolbar-input",this.input.className="singlefile-toolbar-input",this.input.type="text",this.input.placeholder="文件保存路径将显示在这里...",this.input.readOnly=!0,this.button=document.createElement("button"),this.button.id="singlefile-toolbar-button",this.button.className="singlefile-toolbar-button",this.button.innerHTML='\n\t\t\t<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t<path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>\n\t\t\t</svg>\n\t\t\t<span>保存页面</span>\n\t\t',this.button.addEventListener("click",()=>this.handleSaveClick()),this.container.appendChild(this.input),this.container.appendChild(this.button),this.addStyles(),document.body.appendChild(this.container),this.show()}addStyles(){const t=document.createElement("style");t.textContent="\n\t\t\t.singlefile-toolbar-container {\n\t\t\t\tposition: fixed;\n\t\t\t\tbottom: 20px;\n\t\t\t\tright: 20px;\n\t\t\t\tz-index: 2147483647;\n\t\t\t\topacity: 0;\n\t\t\t\ttransform: translateY(20px);\n\t\t\t\ttransition: all 0.3s ease;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-container.visible {\n\t\t\t\topacity: 1;\n\t\t\t\ttransform: translateY(0);\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-input {\n\t\t\t\tpadding: 8px 12px;\n\t\t\t\tborder: 1px solid #ddd;\n\t\t\t\tborder-radius: 6px;\n\t\t\t\tfont-size: 13px;\n\t\t\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n\t\t\t\tbackground: white;\n\t\t\t\tcolor: #333;\n\t\t\t\tmin-width: 200px;\n\t\t\t\tmax-width: 300px;\n\t\t\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-input:focus {\n\t\t\t\toutline: none;\n\t\t\t\tborder-color: #007bff;\n\t\t\t\tbox-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-input::placeholder {\n\t\t\t\tcolor: #999;\n\t\t\t\tfont-style: italic;\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-button {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t\tbackground: #007bff;\n\t\t\t\tcolor: white;\n\t\t\t\tborder: none;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 12px 16px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcursor: pointer;\n\t\t\t\tbox-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\tuser-select: none;\n\t\t\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-button:hover {\n\t\t\t\tbackground: #0056b3;\n\t\t\t\ttransform: translateY(-1px);\n\t\t\t\tbox-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-button:active {\n\t\t\t\ttransform: translateY(0);\n\t\t\t\tbox-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-button svg {\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-button svg.spinning {\n\t\t\t\tanimation: spin 1s linear infinite;\n\t\t\t}\n\t\t\t\n\t\t\t@keyframes spin {\n\t\t\t\tfrom { transform: rotate(0deg); }\n\t\t\t\tto { transform: rotate(360deg); }\n\t\t\t}\n\t\t\t\n\t\t\t.singlefile-toolbar-button span {\n\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\t\t\t\n\t\t\t/* 响应式设计 */\n\t\t\t@media (max-width: 768px) {\n\t\t\t\t.singlefile-toolbar-container {\n\t\t\t\t\tbottom: 10px;\n\t\t\t\t\tright: 10px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.singlefile-toolbar-input {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.singlefile-toolbar-button {\n\t\t\t\t\tpadding: 10px 12px;\n\t\t\t\t\tfont-size: 13px;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.singlefile-toolbar-button span {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t}\n\t\t",document.head.appendChild(t)}setupScrollListener(){let t;addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{(window.pageYOffset||document.documentElement.scrollTop)+window.innerHeight>=document.documentElement.scrollHeight-100?this.hide():this.show()},100)})}setupPageChangeListener(){new MutationObserver(()=>{document.getElementById("singlefile-toolbar-container")||this.init()}).observe(document.body,{childList:!0,subtree:!0})}setupDownloadListener(){browser.runtime.onMessage.addListener(t=>{t&&"toolbar.downloaded"===t.method&&t.fileUrl&&this.onDownloaded(t.fileUrl)})}onDownloaded(t){try{if(!this.input)return;let n=t;n.startsWith("file:///")&&(n=n.substring(8)),n.startsWith("/")&&(n=n.substring(1)),this.input.value=decodeURIComponent(n),this.input.placeholder="文件保存路径",this.setSuccessState()}catch(t){}}show(){this.container&&!this.isVisible&&(this.container.classList.add("visible"),this.isVisible=!0)}hide(){this.container&&this.isVisible&&(this.container.classList.remove("visible"),this.isVisible=!1)}async handleSaveClick(){try{this.setLoadingState(!0),this.input.value="",this.input.placeholder="正在保存页面...";const t=await browser.runtime.sendMessage({method:"business.saveTabs",tabs:[],options:{optionallySelected:!0}});if(t&&!1===t.success)throw new Error(t.error||"Save failed");this.setSuccessState()}catch(t){console.error("SingleFile save error:",t),this.setErrorState()}}setLoadingState(t){this.button&&(t?(this.button.innerHTML='\n\t\t\t\t<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="spinning">\n\t\t\t\t\t<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>\n\t\t\t\t</svg>\n\t\t\t\t<span>保存中...</span>\n\t\t\t',this.button.disabled=!0):(this.button.innerHTML='\n\t\t\t\t<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t<path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>\n\t\t\t\t</svg>\n\t\t\t\t<span>保存页面</span>\n\t\t\t',this.button.disabled=!1))}setSuccessState(){this.button&&(this.button.innerHTML='\n\t\t\t<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>\n\t\t\t</svg>\n\t\t\t<span>保存成功</span>\n\t\t',this.button.style.background="#28a745",setTimeout(()=>{this.setLoadingState(!1),this.button.style.background="#007bff"},3e3))}setErrorState(){this.button&&(this.button.innerHTML='\n\t\t\t<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"/>\n\t\t\t</svg>\n\t\t\t<span>保存失败</span>\n\t\t',this.button.style.background="#dc3545",setTimeout(()=>{this.setLoadingState(!1),this.button.style.background="#007bff"},3e3))}destroy(){this.container&&this.container.remove()}}let n=null;function e(){n||(n=new t)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();
